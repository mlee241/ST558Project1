---
title: "ST 558 Project 1"
author: "Marcus Lee"
date: "6/13/2021"
output: 
  github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=TRUE, warning = FALSE, message=FALSE}
library(ggplot2)
library(jsonlite)
library(knitr)
library(httr)
```


# JSON Data

# Packages used for reading JSON data in R


# Contact the NHL Records API

```{r}
base_url = "https://records.nhl.com/site/api"
```

```{r}
get_franchise = function(){
  full_url = paste0(base_url, "/franchise")
  franchise_text = content(GET(url=full_url), "text")
  franchise_json = fromJSON(franchise_text, flatten = T)
  return(franchise_json$data)
}
```

```{r}
get_franchise_team_totals = function(){
  full_url = paste0(base_url, "/franchise-team-totals")
  franchise_team_totals_text = content(GET(url=full_url), "text")
  franchise_team_totals_json = fromJSON(franchise_team_totals_text, flatten = T)
  return(franchise_team_totals_json$data)
}
```

```{r}
get_franchise_season_records = function(id){
  full_url = paste0(base_url, "/franchise-season-records?cayenneExp=franchiseId=",id)
  franchise_season_records_text = content(GET(url=full_url), "text")
  franchise_season_records_json = fromJSON(franchise_season_records_text, flatten = T)
  return(franchise_season_records_json$data)
}
```

```{r}
get_franchise_goalie_records = function(id){
  full_url = paste0(base_url, "/franchise-goalie-records?cayenneExp=franchiseId=",id)
  franchise_goalie_records_text = content(GET(url=full_url), "text")
  franchise_goalie_records_json = fromJSON(franchise_goalie_records_text, flatten = T)
  return(franchise_goalie_records_json$data)
}
```

```{r}
get_franchise_skater_records = function(id){
  full_url = paste0(base_url, "/franchise-skater-records?cayenneExp=franchiseId=",id)
  franchise_skater_records_text = content(GET(url=full_url), "text")
  franchise_skater_records_json = fromJSON(franchise_skater_records_text, flatten = T)
  return(franchise_skater_records_json$data)
}
```

```{r}
get_franchise_detail = function(id){
  full_url = paste0(base_url, "/franchise-detail?cayenneExp=mostRecentTeamId=",id)
  franchise_detail_text = content(GET(url=full_url), "text")
  franchise_detail_json = fromJSON(franchise_detail_text, flatten = T)
  return(franchise_detail_json$data)
}
```

```{r, echo=FALSE, warning=FALSE, message =FALSE}
id=1
franchise = get_franchise()
franchise_team_total = get_franchise_team_totals()
franchise_season_records = get_franchise_season_records(id)
franchise_goalie_records = get_franchise_skater_records(id)
franchise_skater_records = get_franchise_skater_records(id)
franchise_detail = get_franchise_detail(id)
```

```{r}
kable(franchise)
```


# Contact the NHL Stats API

```{r}
base_stats_url = "https://statsapi.web.nhl.com/api/v1"
```

```{r}
get_team_stats = function(id){
  if (missing(id)==T){
    full_url = paste0(base_stats_url, "/teams?expand=team.stats=")
    team.stats_text = content(GET(url=full_url), "text")
    team.stats_json = fromJSON(team.stats_text, flatten = T)
    team.stats2none_json = team.stats_json[2] # We are ignoring the 1st list since it it useless
    return(team.stats2none_json)
  }
  else{
    full_url =  paste0(base_stats_url, "/teams/",id)
    team.stats_text = content(GET(url=full_url), "text")
    team.stats_json = fromJSON(team.stats_text, flatten = T)
    team.stats2id_json = team.stats_json[2] # We are ignoring the 1st list since it it useless
    return(team.stats2id_json)
  }
}
```

```{r}
id=2
team.stats = get_team_stats(id)
# The code below here should also work if you wanted to print out the whole team.
team.stats = get_team_stats()
```

```{r}
kable(team.stats)
```


```{r}
# So wrapper function could call for modifier(team.stats) or like individual id
#needs to get like the records api as well
get_wrapper <- function(api_url,id){
  if(api_url=="https://records.nhl.com/site/api"){
    base_url="https://records.nhl.com/site/api"
    if(missing(id)==T){
      franchise_wrapper = get_franchise()
      franchise_team_total_wrapper = get_franchise_team_totals()
      records_wrapper_no_id_list = list(franchise_wrapper,franchise_team_total_wrapper)
      return(records_wrapper_no_id_list)
    }
    else{
      franchise_season_records_wrapper = get_franchise_season_records(id)
      franchise_goalie_records_wrapper = get_franchise_skater_records(id)
      franchise_skater_records_wrapper = get_franchise_skater_records(id)
      franchise_detail_wrapper = get_franchise_detail(id)
      records_wrapper_list = list(franchise_season_records_wrapper,franchise_goalie_records_wrapper,franchise_skater_records_wrapper,franchise_detail_wrapper)
      return(records_wrapper_list)
    }
  }
  else{
    base_stats_url="https://statsapi.web.nhl.com/api/v1"
    if(missing(id)==T){
        team.stats = get_team_stats()
        return(team.stats)
    }
    else{
      team.stats = get_team_stats(id)
      return(team.stats)
    }
  }
}
```

```{r}
# so users can enter team id or the modifere here
# test cases, and all of it does work
#wrap = get_wrapper("https://records.nhl.com/site/api",2)
#wrap = get_wrapper("https://records.nhl.com/site/api",)
#wrap = get_wrapper("https://statsapi.web.nhl.com/api/v1",2)
wrap = get_wrapper("https://statsapi.web.nhl.com/api/v1")
```

```{r, echo=FALSE}
#answer= readline(prompt = "Do you want the NHL records or the NHL stats?")
wrap
```









## More functions

## Wrapper functions

# Exploratory Data Analysis













